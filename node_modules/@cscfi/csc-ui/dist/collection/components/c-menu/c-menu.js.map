{"version":3,"file":"c-menu.js","sourceRoot":"","sources":["../../../../src/components/c-menu/c-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Host,\n  h,\n  Element,\n  State,\n  Prop,\n  Listen,\n} from '@stencil/core';\nimport { mdiChevronDown } from '@mdi/js';\nimport { CMenuOption } from '../../types';\n\n/**\n * @group Navigation\n * @slot Default slot - Menu title / activator element (simple variant)\n */\n@Component({\n  tag: 'c-menu',\n  styleUrl: 'c-menu.scss',\n  shadow: true,\n})\nexport class CMenu {\n  @Element() host: HTMLCMenuElement;\n\n  /**\n   * Menu items\n   */\n  @Prop() items: CMenuOption[] = [];\n\n  /**\n   * Menu content css class\n   */\n  @Prop() contentClass = '';\n\n  /**\n   * No chevron and background, E.g. when a button is the activator\n   */\n  @Prop() custom = false;\n\n  /**\n   * Small variant\n   */\n  @Prop() small = false;\n\n  /**\n   * No hover background\n   */\n  @Prop() flat = false;\n\n  /**\n   * Items per page before adding scroll\n   */\n  @Prop() itemsPerPage = 6;\n\n  @State() menuItemsComponent: HTMLCMenuItemsElement | null = null;\n\n  @State() menuWrapperComponent: HTMLDivElement | null = null;\n\n  @State() currentIndex: number = null;\n\n  @State() active = false;\n\n  @Listen('keydown', { capture: true })\n  handleKeyDown(ev: KeyboardEvent) {\n    const openKeys = ['ArrowDown', 'ArrowUp', 'Enter', ' '];\n\n    if (!this.active && openKeys.includes(ev.key)) {\n      ev.preventDefault();\n\n      this.currentIndex = null;\n\n      if (ev.key === 'ArrowDown') {\n        this.currentIndex = 0;\n      }\n\n      if (ev.key === 'ArrowUp') {\n        this.currentIndex = this.items.length - 1;\n      }\n\n      this._onClick();\n    }\n\n    if (ev.key === 'Escape') {\n      this._hideMenu();\n    }\n  }\n\n  private static _uniqueId = 0;\n\n  private _createWrapperElement() {\n    const existingOverlay = document.querySelector('.c-menu-overlay__content');\n\n    if (existingOverlay) return existingOverlay;\n\n    const overlay = document.createElement('div');\n\n    overlay.classList.add('c-menu-overlay');\n\n    const overlayContent = document.createElement('div');\n\n    overlayContent.classList.add('c-menu-overlay__content');\n\n    overlay.appendChild(overlayContent);\n\n    document.body.appendChild(overlay);\n\n    return overlayContent;\n  }\n\n  private _getNativeChild(parent = this.host as Element) {\n    let element = parent.shadowRoot.children[0];\n\n    if (!!element.shadowRoot) {\n      element = this._getNativeChild(element);\n    }\n\n    return element as HTMLElement;\n  }\n\n  private _addMenuItemsComponentListeners(height: number, width: number) {\n    this.menuItemsComponent.onclose = () => {\n      this._hideMenu();\n\n      const element = this._getNativeChild();\n\n      element.focus();\n    };\n\n    this.menuItemsComponent.addEventListener(\n      'open',\n      (event: CustomEvent) => this._onOpen(event, height, width),\n      {\n        once: true,\n      },\n    );\n  }\n\n  private _getHostPosition() {\n    return this.host.getBoundingClientRect();\n  }\n\n  private _hideMenu() {\n    this.menuItemsComponent?.remove();\n    this.menuItemsComponent = null;\n    this.active = false;\n  }\n\n  private _onOpen(event: CustomEvent, height: number, width: number) {\n    window.requestAnimationFrame(() => {\n      const { isInView, height: menuHeight, width: menuWidth } = event.detail;\n\n      if (!isInView.y) {\n        const posY =\n          parseFloat(this.menuItemsComponent.style.top) - menuHeight - height;\n\n        this.menuItemsComponent.style.top = `${posY}px`;\n        this.menuItemsComponent.top = posY;\n      }\n\n      if (!isInView.x) {\n        this.menuItemsComponent.style.left = `${\n          parseFloat(this.menuItemsComponent.style.left) - menuWidth + width\n        }px`;\n      }\n\n      this.active = true;\n      this.menuItemsComponent.active = true;\n\n      this.menuItemsComponent?.shadowRoot?.querySelector('ul')?.focus();\n    });\n  }\n\n  private _onClick() {\n    if (this.menuItemsComponent) return;\n\n    const { bottom, left, width, height } = this._getHostPosition();\n\n    this.menuItemsComponent = document.createElement('c-menu-items');\n\n    this.menuItemsComponent.style.top = `${bottom}px`;\n    this.menuItemsComponent.style.left = `${left}px`;\n    this.menuItemsComponent.style.minWidth = `${width}px`;\n    this.menuItemsComponent.parent = this.host;\n    this.menuItemsComponent.items = this.items;\n    this.menuItemsComponent.small = this.small;\n    this.menuItemsComponent.itemsPerPage = this.itemsPerPage;\n    this.menuItemsComponent.top = bottom;\n    this.menuItemsComponent.id = `c-menu-items-${CMenu._uniqueId}`;\n    this.menuItemsComponent.index = this.currentIndex;\n    this.menuItemsComponent.setAttribute('tabindex', '-1');\n    this.menuItemsComponent.setAttribute('role', 'listbox');\n\n    if (this.contentClass) {\n      this.menuItemsComponent.classList.add(this.contentClass);\n    }\n\n    this._addMenuItemsComponentListeners(height, width);\n\n    this._createWrapperElement().appendChild(this.menuItemsComponent);\n\n    window.setTimeout(() => {\n      (\n        (this.menuItemsComponent?.shadowRoot?.children[0] as HTMLUListElement)\n          ?.children[0] as HTMLLIElement\n      )?.focus();\n    }, 200);\n  }\n\n  componentWillLoad() {\n    CMenu._uniqueId += 1;\n  }\n\n  disconnectedCallback() {\n    this._hideMenu();\n  }\n\n  render() {\n    const hostClasses = {\n      'c-menu': true,\n      'c-menu--custom': this.custom,\n      'c-menu--active': this.active,\n      'c-menu--no-hover': this.flat,\n      'c-menu--small': this.small,\n    };\n\n    return (\n      <Host class={hostClasses}>\n        <button\n          aria-expanded={this.active.toString()}\n          aria-haspopup=\"listbox\"\n          aria-controls={`c-menu-items-${CMenu._uniqueId}`}\n          class={{\n            'c-menu-wrapper': !this.custom,\n            custom: this.custom,\n          }}\n          tabindex=\"0\"\n          type=\"button\"\n          onClick={() => this._onClick()}\n        >\n          {this.custom ? (\n            <slot></slot>\n          ) : (\n            <div class=\"c-menu__header\">\n              <slot></slot>\n\n              <c-icon\n                path={mdiChevronDown}\n                class={\n                  this.active\n                    ? 'c-menu__icon c-menu__icon--rotated'\n                    : 'c-menu__icon'\n                }\n              />\n            </div>\n          )}\n        </button>\n      </Host>\n    );\n  }\n}\n"]}