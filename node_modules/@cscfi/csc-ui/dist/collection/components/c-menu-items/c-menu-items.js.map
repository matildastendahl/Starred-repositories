{"version":3,"file":"c-menu-items.js","sourceRoot":"","sources":["../../../../src/components/c-menu-items/c-menu-items.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Host,\n  h,\n  Element,\n  Event,\n  EventEmitter,\n  Prop,\n  State,\n  Listen,\n  Watch,\n} from '@stencil/core';\nimport { CMenuOption } from '../../types';\nimport { getScrollParent } from '../../utils';\n\n/**\n * @parent c-menu\n */\n@Component({\n  tag: 'c-menu-items',\n  styleUrl: 'c-menu-items.scss',\n  shadow: true,\n})\nexport class CMenuItems {\n  @Element() host: HTMLCMenuItemsElement;\n\n  /**\n   * Menu items\n   * @private\n   */\n  @Prop() items: CMenuOption[] = [];\n\n  /**\n   * Small variant\n   * @private\n   */\n  @Prop() small = false;\n\n  /**\n   * Menu is opened and positioned\n   * @private\n   */\n  @Prop() active = false;\n\n  /**\n   * Type of parent\n   * @private\n   */\n  @Prop() parentType = 'menu';\n\n  /**\n   * Menu parent\n   * @private\n   */\n  @Prop() parent: HTMLCMenuElement;\n\n  /**\n   * Initial top position\n   * @private\n   */\n  @Prop() top = 0;\n\n  /**\n   * is active\n   * @private\n   */\n  @Prop() index: number | null = null;\n\n  /**\n   * Items per page before adding scroll\n   * @private\n   */\n  @Prop() itemsPerPage = 6;\n\n  /**\n   * Triggered when the menu is closed\n   * @private\n   */\n  @Event() close: EventEmitter;\n\n  /**\n   * Triggered when the menu is opened\n   * @private\n   */\n  @Event() open: EventEmitter<{\n    height: number;\n    width: number;\n    isInView: {\n      x: boolean;\n      y: boolean;\n    };\n  }>;\n\n  @State() scrollingParent: Element;\n\n  @State() isInView = true;\n\n  @State() currentIndex: number = null;\n\n  @Watch('currentIndex')\n  onIndexChange(index: number) {\n    this.listItems.forEach((item, i) => {\n      item.classList.toggle('active', i === index);\n\n      if (i === index) {\n        item.focus();\n      }\n    });\n  }\n\n  @Listen('keydown', { capture: true })\n  handleKeyDown(event: KeyboardEvent) {\n    if (event.key === 'ArrowDown') {\n      event.preventDefault();\n\n      if (this.currentIndex === null) {\n        this.currentIndex = 0;\n      } else if (this.currentIndex + 1 < this.items.length) {\n        this.currentIndex += 1;\n      }\n    }\n\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n\n      if (this.currentIndex === null) {\n        this.currentIndex = this.items.length - 1;\n      } else if (this.currentIndex > 0) {\n        this.currentIndex -= 1;\n      }\n    }\n\n    if (event.key === 'Escape') {\n      this.close.emit();\n      this.currentIndex = null;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n\n      if (this.currentIndex !== null) {\n        const item = this.items[this.currentIndex];\n\n        if (!item.disabled) {\n          item.action();\n          this.close.emit();\n        }\n\n        return;\n      }\n\n      this.currentIndex = 0;\n    }\n\n    if (event.key === ' ') {\n      event.preventDefault();\n\n      if (this.currentIndex !== null) {\n        const item = this.items[this.currentIndex];\n\n        if (item?.disabled) return;\n\n        item?.action();\n      }\n\n      this.close.emit();\n    }\n\n    if (event.key === 'Tab') {\n      if (this.parentType !== 'menu' && this.currentIndex !== null) {\n        const item = this.items[this.currentIndex];\n\n        if (!item?.disabled) {\n          item?.action();\n        }\n      }\n\n      this.close.emit();\n    }\n\n    if (event.key === 'PageUp') {\n      this.currentIndex = Math.max(0, this.currentIndex - this.itemsPerPage);\n    }\n\n    if (event.key === 'PageDown') {\n      this.currentIndex = Math.min(\n        this.items.length - 1,\n        this.currentIndex + this.itemsPerPage,\n      );\n    }\n  }\n\n  private _listElement: HTMLUListElement;\n\n  private _boundFn: () => void;\n\n  private _boundClickFn: () => void;\n\n  private _parentTop = 0;\n\n  private _itemHeight = 42;\n\n  private _itemHeightSmall = 36;\n\n  get listItems(): HTMLLIElement[] {\n    return Array.from(this.host?.shadowRoot?.querySelectorAll('li') || []);\n  }\n\n  private _handleItemsPerPage() {\n    const itemHeight = this.small ? this._itemHeightSmall : this._itemHeight;\n\n    const containerHeight = this.itemsPerPage * itemHeight + itemHeight / 2;\n\n    this._listElement.style.maxHeight = `${containerHeight}px`;\n    this._listElement.style.setProperty(\n      '--_c-menu-item-height',\n      `${itemHeight}px`,\n    );\n  }\n\n  private _onOpen() {\n    this._handleItemsPerPage();\n\n    window.requestAnimationFrame(async () => {\n      const viewportHeight = window.innerHeight;\n      const viewportWidth = window.innerWidth;\n\n      const { bottom, right, height, width } =\n        this._listElement.getBoundingClientRect();\n\n      const { top: parentTop } = this.parent.getBoundingClientRect();\n\n      this._parentTop = parentTop;\n\n      this.scrollingParent = await getScrollParent(this.parent);\n\n      this._boundFn = this._onScroll.bind(this);\n\n      this.scrollingParent.addEventListener('scroll', this._boundFn);\n\n      this.open.emit({\n        height,\n        isInView: {\n          x: right < viewportWidth,\n          y: bottom < viewportHeight,\n        },\n        width,\n      });\n    });\n  }\n\n  private _onScroll() {\n    const { top: parentTop } = this.parent.getBoundingClientRect();\n\n    const differenceY = this._parentTop - parentTop;\n\n    this.host.style.top = `${this.top - differenceY}px`;\n  }\n\n  private _handleClick(event) {\n    if (!event.composedPath().includes(this.host)) {\n      this.close.emit();\n    }\n  }\n\n  private _handleZIndex() {\n    const styles = window.getComputedStyle(\n      (this.parent.assignedSlot || this.parent).parentElement,\n    );\n\n    const zIndex = styles.getPropertyValue('z-index');\n\n    this.host.style.zIndex = zIndex === 'auto' ? '1' : zIndex;\n  }\n\n  componentDidLoad() {\n    this._boundClickFn = this._handleClick.bind(this);\n\n    window.addEventListener('click', this._boundClickFn, {\n      once: true,\n    });\n\n    this._handleZIndex();\n\n    this._onOpen();\n\n    this.currentIndex = this.index;\n  }\n\n  disconnectedCallback() {\n    this.scrollingParent.removeEventListener('scroll', this._boundFn);\n    window.removeEventListener('click', this._boundClickFn);\n  }\n\n  private _renderItem = (item) => {\n    const classes = {\n      disabled: item.disabled,\n      'icon-start': item.iconPosition === 'start',\n      'icon-end': item.iconPosition === 'end',\n    };\n\n    const onItemClick = (event, item) => {\n      event.stopPropagation();\n\n      if (!item.disabled) {\n        item.action();\n\n        this.close.emit();\n      }\n    };\n\n    return (\n      <li\n        aria-disabled={(!!item.disabled).toString()}\n        class={classes}\n        tabindex=\"-1\"\n        role=\"menuitem\"\n        onClick={(event) => onItemClick(event, item)}\n      >\n        {item.name}\n\n        {item.icon && (\n          <svg class=\"icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\">\n            <path d={item.icon} />\n          </svg>\n        )}\n      </li>\n    );\n  };\n\n  render() {\n    const listClasses = {\n      'c-menu-items': true,\n      'c-menu-items--small': this.small,\n      'c-menu-items--active': this.active,\n    };\n\n    return (\n      <Host>\n        <ul class={listClasses} ref={(el) => (this._listElement = el)}>\n          {this.items.map((item) => this._renderItem(item))}\n        </ul>\n      </Host>\n    );\n  }\n}\n"]}